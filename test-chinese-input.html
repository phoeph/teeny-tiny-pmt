<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>中文输入法测试</title>
    <style>
        body {
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        .test-input {
            width: 300px;
            padding: 8px 12px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 14px;
            direction: ltr !important;
            text-align: left !important;
            unicode-bidi: normal !important;
            margin: 10px 0;
        }
        .test-container {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .log {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h2>中文输入法兼容性测试</h2>
    
    <div class="test-container">
        <h3>测试1: 标准输入框（参考）</h3>
        <input type="text" class="test-input" placeholder="输入中文测试..." id="standardInput" />
        <p>在上面输入框中使用拼音输入法输入"北京"，应该正常工作</p>
        <div id="standardLog" class="log"></div>
    </div>
    
    <div class="test-container">
        <h3>测试2: 带实时搜索的输入框（模拟Labels搜索框）</h3>
        <input type="text" class="test-input" placeholder="输入中文测试..." id="searchInput" />
        <p>在上面输入框中使用拼音输入法输入"北京"，测试是否会被打断</p>
        <div id="searchResults" style="margin-top: 10px; padding: 10px; background: #f0f8ff; border-radius: 4px;">
            搜索结果将显示在这里...
        </div>
        <div id="searchLog" class="log"></div>
    </div>
    
    <div class="test-container">
        <h3>测试说明</h3>
        <ul>
            <li><strong>正确行为</strong>: 输入"jing"时，应该显示拼音候选，选择后变成"京"</li>
            <li><strong>错误行为</strong>: 输入"jing"时，只显示最后的"g"，前面的"jin"被忽略</li>
            <li><strong>测试词汇</strong>: 北京、上海、广州、深圳、杭州等</li>
        </ul>
    </div>

    <script>
        // 标准输入框事件监听
        const standardInput = document.getElementById('standardInput');
        const standardLog = document.getElementById('standardLog');
        
        function logStandard(event, value) {
            const time = new Date().toLocaleTimeString();
            standardLog.innerHTML += `[${time}] ${event}: "${value}"<br>`;
            standardLog.scrollTop = standardLog.scrollHeight;
        }
        
        standardInput.addEventListener('compositionstart', (e) => {
            logStandard('compositionstart', e.data || '');
        });
        
        standardInput.addEventListener('compositionupdate', (e) => {
            logStandard('compositionupdate', e.data || '');
        });
        
        standardInput.addEventListener('compositionend', (e) => {
            logStandard('compositionend', e.data || '');
        });
        
        standardInput.addEventListener('input', (e) => {
            logStandard('input', e.target.value);
        });
        
        // 搜索输入框事件监听（模拟Labels搜索框行为）
        const searchInput = document.getElementById('searchInput');
        const searchResults = document.getElementById('searchResults');
        const searchLog = document.getElementById('searchLog');
        let isComposing = false;
        
        function logSearch(event, value) {
            const time = new Date().toLocaleTimeString();
            searchLog.innerHTML += `[${time}] ${event}: "${value}" (composing: ${isComposing})<br>`;
            searchLog.scrollTop = searchLog.scrollHeight;
        }
        
        function updateSearchResults(value) {
            if (value.trim()) {
                searchResults.innerHTML = `搜索 "${value}" 的结果:<br>• 模拟结果1<br>• 模拟结果2<br>• 模拟结果3`;
            } else {
                searchResults.innerHTML = '搜索结果将显示在这里...';
            }
        }
        
        searchInput.addEventListener('compositionstart', (e) => {
            isComposing = true;
            logSearch('compositionstart', e.data || '');
        });
        
        searchInput.addEventListener('compositionupdate', (e) => {
            isComposing = true;
            logSearch('compositionupdate', e.data || '');
        });
        
        searchInput.addEventListener('compositionend', (e) => {
            isComposing = false;
            logSearch('compositionend', e.data || '');
            // 输入法结束后更新搜索结果
            updateSearchResults(e.target.value);
        });
        
        searchInput.addEventListener('input', (e) => {
            logSearch('input', e.target.value);
            // 只有在不使用输入法时才立即更新搜索结果
            if (!isComposing) {
                updateSearchResults(e.target.value);
            }
        });
    </script>
</body>
</html>